var Tests;(function(){describe("compiler",function(){function r(n){var t="0000"+n.toString(16);return t.substring(t.length-4,t.length).toUpperCase()}var i,n,u,t;beforeEach(function(){module("app")}),beforeEach(function(){inject(function(r,f){i=r,u=f,n=i.getCpu(),t=i.getCompiler()})}),describe("given compiler when decompiler called with code",function(){beforeEach(function(){var i=new Emulator.JmpAbsolute,t=n.rPC;n.poke(n.rPC,i.opCode),n.poke(n.rPC+1,t&Constants.Memory.ByteMask),n.poke(n.rPC+2,t>>Constants.Memory.BitsInByte)}),it("then should return the decompiled code",function(){var i=t.decompile(n.rPC);expect(i).toContain("$"+r(n.rPC)+": JMP $"+r(n.rPC))})}),describe("given compiler when compile called with simple code",function(){beforeEach(function(){t.compile("JMP $"+r(n.rPC))}),it("then should compile the code at the default address",function(){var t=new Emulator.JmpAbsolute,i=[t.opCode,n.rPC&Constants.Memory.ByteMask,n.rPC>>Constants.Memory.BitsInByte&Constants.Memory.ByteMask],r=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)];expect(JSON.stringify(r)).toEqual(JSON.stringify(i))})}),describe("given compiler when compile called with comments",function(){var n;beforeEach(function(){n=t.compile(";this is a comment     \n;this is another comment.")}),it("then should ignore the comments",function(){expect(n).toBe(!0)})}),describe("given compiler when a memory label is specified",function(){var i;beforeEach(function(){i=t.compile("$C000: JMP $C000")}),it("then should compile starting at the memory address",function(){var t=new Emulator.JmpAbsolute,r=[t.opCode,0,192],u=[n.peek(49152),n.peek(49153),n.peek(49154)];expect(i).toBe(!0),expect(JSON.stringify(u)).toEqual(JSON.stringify(r))}),it("then should set the program counter to the start address",function(){expect(n.rPC).toBe(49152)})}),describe("given compiler when a start address is specified",function(){var i;beforeEach(function(){i=t.compile("* = $C000      \nJMP $C000        ")}),it("then should set the start address to the specified address and compile the code",function(){var t=new Emulator.JmpAbsolute,r=[t.opCode,0,192],u=[n.peek(49152),n.peek(49153),n.peek(49154)];expect(i).toBe(!0),expect(JSON.stringify(u)).toEqual(JSON.stringify(r))}),it("then should set the program counter to the start address",function(){expect(n.rPC).toBe(49152)})}),describe("given compiler when a start address is specified with decimal",function(){var i;beforeEach(function(){i=t.compile("* = 49152      \nJMP 49152        ")}),it("then should set the start address to the specified address and compile the code",function(){var t=new Emulator.JmpAbsolute,r=[t.opCode,0,192],u=[n.peek(49152),n.peek(49153),n.peek(49154)];expect(i).toBe(!0),expect(JSON.stringify(u)).toEqual(JSON.stringify(r))}),it("then should set the program counter to the start address",function(){expect(n.rPC).toBe(49152)})}),describe("given compiler when source is provided with labels",function(){var i;beforeEach(function(){i=t.compile("LOOP: JMP LOOP")}),it("then should resolve the labels and compile the code using the appropriate addresses",function(){var t=new Emulator.JmpAbsolute,r=[t.opCode,n.rPC&Constants.Memory.ByteMask,n.rPC>>Constants.Memory.BitsInByte&Constants.Memory.ByteMask],u=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)];expect(i).toBe(!0),expect(JSON.stringify(u)).toEqual(JSON.stringify(r))})}),describe("given compiler when source is provided with duplicate labels",function(){var i,r;beforeEach(function(){r=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)],i=t.compile("LOOP: JMP LOOP      \nLOOP: JMP LOOP")}),it("then should not compile and log a message to the console",function(){expect(i).toBe(!1);var t=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)];expect(JSON.stringify(t)).toBe(JSON.stringify(r))})}),describe("given compiler when source is provided with invalid op codes",function(){var i,r;beforeEach(function(){r=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)],i=t.compile("BLEH $C000")}),it("then should not compile and log a message to the console",function(){expect(i).toBe(!1);var t=[n.peek(n.rPC),n.peek(n.rPC+1),n.peek(n.rPC+2)];expect(JSON.stringify(t)).toBe(JSON.stringify(r))})}),describe("given compiler when a return from subroutine is specified",function(){var i;beforeEach(function(){i=t.compile("* = 49152      \nRTS        ")}),it("then should set the RTS op code at the memory location",function(){var t=new Emulator.RtsSingle;expect(i).toBe(!0),expect(n.peek(49152)).toEqual(t.opCode)}),it("then should set the program counter to the start address",function(){expect(n.rPC).toBe(49152)})}),describe("given compiler when immediate mode is specified",function(){var i;beforeEach(function(){i=t.compile("LDA #$0A   \nLDA #22   ; this is a comment")}),it("then should handle a hex value",function(){expect(i).toBe(!0),expect(n.peek(n.rPC+1)).toBe(10)}),it("then should handle the decimal value",function(){expect(i).toBe(!0),expect(n.peek(n.rPC+3)).toBe(22)})}),describe("given compiler when immediate mode is specified with invalid value",function(){var n;beforeEach(function(){n=t.compile("LDA #$0AB")}),it("then should not compile",function(){expect(n).toBe(!1)})})})})(Tests||(Tests={}))